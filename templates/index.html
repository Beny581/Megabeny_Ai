<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Megabeny AI Chart</title>
<style>
:root{--bg:#fff;--text:#000;--card:#f5f5f5;--primary:#4285F4}
.dark-mode{--bg:#121212;--text:#fff;--card:#1e1e1e}
body{margin:0;font-family:Segoe UI,sans-serif;background:var(--bg);color:var(--text)}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:var(--primary);color:#fff}
.menu-toggle,.user-icon,.sub-icon{font-size:22px;cursor:pointer}
.logo{font-weight:bold}

.sidebar{position:fixed;top:0;left:0;width:250px;height:100%;background:#333;color:#fff;padding:20px;transform:translateX(-100%);transition:.3s;z-index:1000}
.sidebar.open{transform:translateX(0)}
.sidebar ul{list-style:none;padding:0}
.sidebar li{margin:15px 0;cursor:pointer}

.overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;z-index:999}
.overlay.active{display:block}

.container{padding:15px;max-width:900px;margin:auto}

.chat-box{background:var(--card);border-radius:10px;padding:15px;height:350px;overflow-y:auto}
.message{margin:10px 0}
.user{text-align:right}
.ai{text-align:left;opacity:.95}
.typing{opacity:.6;font-style:italic}

.input-area{display:flex;margin-top:10px;gap:6px;align-items:center}
.input-area input[type="text"]{flex:1;padding:12px;border-radius:8px;border:1px solid #ccc}
.send-btn{background:var(--primary);color:#fff;border:none;padding:0 16px;border-radius:8px;font-size:18px;cursor:pointer}
.upload-label{font-size:20px;cursor:pointer}
.upload-label input{display:none}

.voice-btn{margin-top:10px;background:#4CAF50;border:none;color:#fff;padding:10px;border-radius:6px;cursor:pointer}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:2000}
.modal-content{background:var(--bg);padding:25px;width:90%;max-width:400px;border-radius:12px}
.features-row{display:flex;justify-content:space-between;margin:8px 0}
.modal button{width:100%;margin-top:15px;padding:12px}
</style>
</head>
<body>

<header>
  <div class="menu-toggle" onclick="toggleSidebar()">â˜°</div>
  <div class="logo">Megabeny AI Chart</div>
  <div>
    <span class="sub-icon" onclick="openSub()">ðŸ’Ž</span>
    <span class="user-icon" onclick="toggleMode()">ðŸŒ™</span>
    <button onclick="loginGoogle()" style="margin-left:8px;padding:6px;border-radius:4px;">
      Sign in Google
    </button>
  </div>
</header>

<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<div class="sidebar" id="sidebar">
  <h3>Menu</h3>
  <ul>
    <li onclick="newChat()">âž• New Chat</li>
    <li onclick="loadHistory()">ðŸ“œ View History</li>
    <li onclick="deleteHistory()">ðŸ—‘ Delete History</li>
  </ul>
</div>

<div class="container">

  <div class="chat-box" id="chatBox">
    <div class="me8ssage ai">ðŸ‘‹ Wellcome Megabeny AI Assistant</div>
  </div>

  <div class="input-area">
    <label class="upload-label">ðŸ“Ž
      <input type="file" accept="image/*,video/*" onchange="uploadFile(this)">
    </label>
    <input type="text" id="userInput" placeholder="Ask,learn,brainstorm...." onkeydown="enterSend(event)">
    <button class="send-btn" onclick="sendMessage()">âž¤</button>
  </div>

  <button class="voice-btn">ðŸŽ¤ Voice Chart</button>
</div>

<div class="modal" id="subModal">
  <div class="modal-content">
    <h3>Upgrade plan ðŸ’Ž</h3>
    <p style="margin-bottom:12px;">Get more access to our most popular features</p>
    <div class="features-row"><span>Access to GPT-5</span><span>âœ…</span></div>
    <div class="features-row"><span>More Messages</span><span>âœ…</span></div>
    <div class="features-row"><span>More File Uploads</span><span>âœ…</span></div>
    <div class="features-row"><span>More Image Generation</span><span>âœ…</span></div>
    <div class="features-row"><span>Advanced Data Analysis</span><span>âœ…</span></div>
    <div class="features-row"><span>More Memory</span><span>âœ…</span></div>
    <div class="features-row"><span>Restore Subscription</span><span>âœ…</span></div>
    <button style="background:#ccc;cursor:not-allowed;margin-top:15px;">Upgrade â€“ Coming Soon</button>
    <button onclick="closeSub()" style="margin-top:10px;">Close</button>
  </div>
</div>

<script>
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
const chatBox = document.getElementById("chatBox");
const userInput = document.getElementById("userInput");
const subModal = document.getElementById("subModal");

function toggleSidebar(){sidebar.classList.toggle("open");overlay.classList.toggle("active")}
function closeSidebar(){sidebar.classList.remove("open");overlay.classList.remove("active")}
function toggleMode(){document.body.classList.toggle("dark-mode")}

function sendMessage(){
  const msg = userInput.value.trim();
  if(!msg) return;
  chatBox.innerHTML += `<div class="message user">${msg}</div>`;
  const typing = document.createElement("div");
  typing.className = "message ai typing";
  typing.innerText = "ðŸ¤– Megabeny AI typing...";
  chatBox.appendChild(typing);
  userInput.value = "";
  chatBox.scrollTop = chatBox.scrollHeight;

  fetch("/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:msg})
  })
  .then(r=>r.json())
  .then(d=>{
    typing.remove();
    chatBox.innerHTML += `<div class="message ai">${d.reply}</div>`;
    chatBox.scrollTop = chatBox.scrollHeight;
  });
}

function enterSend(e){if(e.key==="Enter") sendMessage();}
function newChat(){chatBox.innerHTML="<div class='message ai'>ðŸ†• New chat started</div>";}
function loadHistory(){fetch("/history").then(r=>r.json()).then(d=>{chatBox.innerHTML="";d.forEach(m=>{chatBox.innerHTML+=`<div class='message ${m[0]=='user'?'user':'ai'}'>${m[1]}</div>`;});});}
function deleteHistory(){if(confirm("Delete all history?")){fetch("/delete-history",{method:"POST"}).then(()=>newChat());}}
function uploadFile(input){const file=input.files[0];const fd=new FormData();fd.append("file",file);fetch("/upload",{method:"POST",body:fd}).then(()=>chatBox.innerHTML+=`<div class="message ai">âž•File uploaded</div>`);}
function openSub(){subModal.style.display="flex"}
function closeSub(){subModal.style.display="none"}
function loginGoogle(){window.location="/login"}

// Voice button disabled
document.querySelector(".voice-btn").addEventListener("click", () => {
  alert("Voice support not available in this deployment yet. Please type your message.");
});
</script>
</body>
</html>
